<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nosso Mundo ‚ù§Ô∏è</title>
    
    <!-- Firebase B√ÅSICO (s√≥ chat) -->
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; padding: 20px; background: #fff5f8; font-family: sans-serif; }
        
        .tela-login {
            max-width: 400px;
            margin: 50px auto;
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(255,79,135,0.2);
        }
        
        h1 { color: #ff4f87; margin-bottom: 30px; }
        
        .botao {
            width: 100%;
            padding: 16px;
            margin: 10px 0;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            display: block;
        }
        
        #btnGoogle {
            background: white;
            border: 2px solid #ddd;
            color: #444;
        }
        
        #btnNotificar {
            background: linear-gradient(135deg, #4CAF50, #2ecc71);
            color: white;
            margin-top: 20px;
        }
        
        #btnInstalar {
            background: linear-gradient(135deg, #2196F3, #21CBF3);
            color: white;
        }
        
        #status {
            margin-top: 15px;
            padding: 12px;
            border-radius: 10px;
            background: #f9f9f9;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>

<div class="tela-login" id="telaLogin">
    <h1>Nosso Mundo ‚ù§Ô∏è</h1>
    
    <button class="botao" id="btnGoogle" onclick="loginGoogle()">
        <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="20" style="vertical-align: middle;">
        Entrar com Google
    </button>
    
    <div id="areaNick" style="display:none; margin:20px 0;">
        <input type="text" id="inputNick" placeholder="Seu apelido" style="width:100%; padding:12px; border:2px solid #eee; border-radius:10px; margin-bottom:10px;">
        <button class="botao" onclick="salvarNick()" style="background:#ff4f87; color:white;">Continuar</button>
    </div>
    
    <button class="botao" id="btnNotificar" onclick="ativarNotificacoesSIMPLES()">
        üîî ATIVAR NOTIFICA√á√ïES
    </button>
    
    <div id="status">
        Toque no bot√£o acima para ativar
    </div>
    
    <button class="botao" id="btnInstalar" onclick="instalarPWA()" style="display:none; margin-top:15px;">
        üì≤ INSTALAR APP
    </button>
</div>

<script>
// ==================== CONFIG FIREBASE (S√ì CHAT) ====================
const firebaseConfig = {
    apiKey: "AIzaSyAsK3kEuustv7KyoQXR0Ep-whTpDCDa03w",
    authDomain: "manuu-c23a7.firebaseapp.com",
    databaseURL: "https://manuu-c23a7-default-rtdb.firebaseio.com",
    projectId: "manuu-c23a7",
    storageBucket: "manuu-c23a7.firebasestorage.app",
    messagingSenderId: "378235951611",
    appId: "1:378235951611:web:72c855fbb5ccdb1a84535e"
};

firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();

let usuario = null;
let meuNick = localStorage.getItem('meu_nick');

// ==================== FUN√á√ÉO QUE FUNCIONA MESMO ====================
async function ativarNotificacoesSIMPLES() {
    const status = document.getElementById('status');
    
    console.log('=== INICIANDO TESTE SIMPLES ===');
    
    // 1. PEDE PERMISS√ÉO (isso sempre funciona)
    status.innerHTML = '‚è≥ Aguarde o pop-up do navegador...';
    status.style.background = '#FFF3CD';
    status.style.color = '#856404';
    
    const permissao = await Notification.requestPermission();
    console.log('Usu√°rio escolheu:', permissao);
    
    // 2. SE PERMITIU
    if (permissao === 'granted') {
        status.innerHTML = '‚úÖ Permiss√£o concedida! Enviando notifica√ß√£o...';
        status.style.background = '#D4EDDA';
        status.style.color = '#155724';
        
        // ESPERA 1 segundo
        await new Promise(resolve => setTimeout(resolve, 1000));
        
        // 3. MOSTRA NOTIFICA√á√ÉO (100% funciona se tem permiss√£o)
        try {
            const notificacao = new Notification('üéâ CONSEGUIMOS!', {
                body: 'Notifica√ß√µes ativadas com sucesso!',
                icon: 'https://cdn-icons-png.flaticon.com/512/1077/1077114.png',
                badge: 'https://cdn-icons-png.flaticon.com/512/1077/1077114.png',
                vibrate: [200, 100, 200], // Vibra no celular
                tag: 'sucesso',
                requireInteraction: true // Fica na tela at√© clicar
            });
            
            console.log('Notifica√ß√£o criada:', notificacao);
            
            status.innerHTML = '‚úÖ NOTIFICA√á√ÉO ENVIADA! Olhe no topo da tela!';
            
            // Muda o bot√£o
            document.getElementById('btnNotificar').innerHTML = 'üîî NOTIFICA√á√ïES ATIVADAS';
            document.getElementById('btnNotificar').style.background = 'linear-gradient(135deg, #2ecc71, #27ae60)';
            
        } catch (erro) {
            console.error('Erro ao criar notifica√ß√£o:', erro);
            status.innerHTML = '‚ö†Ô∏è Permiss√£o OK, mas erro t√©cnico. Recarregue a p√°gina.';
        }
        
    } else {
        // 4. SE NEGOU
        status.innerHTML = '‚ùå Voc√™ negou a permiss√£o. Para ativar depois:<br>' +
                          'Chrome ‚Üí ‚ãÆ ‚Üí Configura√ß√µes ‚Üí Notifica√ß√µes ‚Üí Seu site ‚Üí Permitir';
        status.style.background = '#F8D7DA';
        status.style.color = '#721C24';
    }
}

// ==================== FUN√á√ïES DE LOGIN ====================
function loginGoogle() {
    auth.signInWithPopup(new firebase.auth.GoogleAuthProvider());
}

auth.onAuthStateChanged(user => {
    if (user) {
        usuario = user;
        if (!meuNick) {
            document.getElementById('areaNick').style.display = 'block';
            document.getElementById('btnGoogle').style.display = 'none';
        } else {
            iniciarApp();
        }
    }
});

function salvarNick() {
    const nick = document.getElementById('inputNick').value.trim();
    if (nick) {
        meuNick = nick;
        localStorage.setItem('meu_nick', nick);
        iniciarApp();
    }
}

function iniciarApp() {
    alert('App iniciado! Agora vamos focar s√≥ nas notifica√ß√µes primeiro.');
}

// ==================== INSTALA√á√ÉO PWA ====================
let promptInstalacao;

window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    promptInstalacao = e;
    document.getElementById('btnInstalar').style.display = 'block';
});

function instalarPWA() {
    if (promptInstalacao) {
        promptInstalacao.prompt();
        promptInstalacao.userChoice.then(choice => {
            if (choice.outcome === 'accepted') {
                document.getElementById('status').innerHTML = '‚úÖ App instalado!';
            }
            promptInstalacao = null;
        });
    }
}

// ==================== TESTE AUTOM√ÅTICO ====================
window.addEventListener('load', () => {
    console.log('=== APP CARREGADO ===');
    console.log('Notification.permission:', Notification.permission);
    
    // Se j√° tem permiss√£o, mostra mensagem
    if (Notification.permission === 'granted') {
        document.getElementById('status').innerHTML = 
            '‚úÖ Notifica√ß√µes j√° est√£o ativadas! Toque no bot√£o para testar.';
        document.getElementById('btnNotificar').innerHTML = 'üîî TESTAR NOTIFICA√á√ÉO';
    }
});
</script>

</body>
</html>
