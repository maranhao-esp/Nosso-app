<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nosso EspaÃ§o â¤ï¸</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getDatabase, ref, push, onChildAdded } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-database.js";
import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyAsK3kEuustv7KyoQXR0Ep-whTpDCDa03w",
  authDomain: "manuu-c23a7.firebaseapp.com",
  databaseURL: "https://manuu-c23a7-default-rtdb.firebaseio.com",
  projectId: "manuu-c23a7",
  storageBucket: "manuu-c23a7.firebasestorage.app",
  messagingSenderId: "378235951611",
  appId: "1:378235951611:web:72c855fbb5ccdb1a84535e",
  measurementId: "G-2V1EXW1794"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);
const auth = getAuth();

const emailsPermitidos = [
"lorenzemanuelly@gmail.com",
"caua60198@gmail.com"
];

let usuario=null;

window.loginGoogle = async ()=>{
 const provider=new GoogleAuthProvider();
 const result=await signInWithPopup(auth,provider);
 if(!emailsPermitidos.includes(result.user.email)){
   alert("Sem acesso");
   auth.signOut();
 }
};

onAuthStateChanged(auth,(user)=>{
 if(user){
   usuario=user.displayName;
   document.getElementById("status").innerText="Logado: "+usuario;
 }
});

window.enviarChat=()=>{
 const msg=document.getElementById("msg").value;
 push(ref(db,"chat"),{
  autor:usuario,
  texto:msg,
  hora:new Date().toLocaleTimeString()
 });
 document.getElementById("msg").value="";
};

onChildAdded(ref(db,"chat"),(data)=>{
 const d=data.val();
 document.getElementById("chat").innerHTML+=
 `<div><b>${d.autor}</b> (${d.hora}): ${d.texto}</div>`;
});

window.enviarPensamento=()=>{
 const msg=document.getElementById("pensamento").value;
 push(ref(db,"pensamentos"),{
  autor:usuario,
  texto:msg,
  hora:new Date().toLocaleTimeString()
 });
 document.getElementById("pensamento").value="";
};

onChildAdded(ref(db,"pensamentos"),(data)=>{
 const d=data.val();
 document.getElementById("pensamentos").innerHTML+=
 `<div>${d.autor} (${d.hora}): ${d.texto}</div>`;
});

window.enviarLista=()=>{
 const msg=document.getElementById("lista").value;
 push(ref(db,"listaLivre"),{
  autor:usuario,
  texto:msg,
  hora:new Date().toLocaleTimeString()
 });
 document.getElementById("lista").value="";
};

onChildAdded(ref(db,"listaLivre"),(data)=>{
 const d=data.val();
 document.getElementById("listas").innerHTML+=
 `<div>â€¢ ${d.texto} - ${d.autor} (${d.hora})</div>`;
});
</script>

</head>
<body>

<h2>Nosso EspaÃ§o â¤ï¸</h2>
<button onclick="loginGoogle()">Entrar com Google</button>
<p id="status"></p>

<h3>ğŸ’¬ Chat</h3>
<div id="chat"></div>
<input id="msg">
<button onclick="enviarChat()">Enviar</button>

<h3>ğŸ’­ Pensamentos</h3>
<div id="pensamentos"></div>
<input id="pensamento">
<button onclick="enviarPensamento()">Enviar</button>

<h3>ğŸ“‹ Lista Livre</h3>
<div id="listas"></div>
<input id="lista">
<button onclick="enviarLista()">Adicionar</button>

</body>
</html>
